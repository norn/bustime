var ua=navigator.userAgent.toLowerCase(),isAndroid=/android/.test(ua),isiOs=/(iphone|ipod|ipad)/.test(ua),isStandAlone=window.navigator.standalone,isiPad=ua.match(/ipad/),isDevice="ontouchstart"in window,isChrome="chrome"in window,isMoz="mozAnimationStartTime"in window;String.prototype.asId=function(){return this.replace(/[^a-zA-Z0-9_]+/g,"")};function supportType(b){var m=document.createElement("audio");b=m.canPlayType&&m.canPlayType(b);return""==b?!1:!0}
(function(b){function m(a){this.name="string"==typeof a?a:a.mp3.split(".")[0].asId();this.soundInPlay=null;this.playingSounds=[];this.isMuted=!1;b.mbAudio.ch.push(this)}b.mbAudio={name:"mb.audio",author:"Matteo Bicocchi",version:"1.5",defaults:{id:"",ogg:"",mp3:"",loop:!1,volume:10},sounds:{},players:{},loaded:{},playing:[],ch:[],soundsMutedByHand:!1,build:function(a){b.mbAudio.isInit||(b(window).on("blur",function(){b.mbAudio.soundsMutedByHand=!0;b.mbAudio.muteAllSounds()}).on("focus",function(){b.mbAudio.soundsMutedByHand=
!1;b.mbAudio.unMuteAllSounds()}),b.mbAudio.isInit=!0);var c="string"==typeof a?b.mbAudio.sounds[a]:a;a=c.id?c.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[a]&&(c=supportType("audio/mpeg")?c.mp3:c.ogg,b.mbAudio.players[a]=new Audio(c),b.mbAudio.players[a].load(),b.mbAudio.players[a].pause(),b.mbAudio.loaded[a]=1)},getPlayer:function(a){var c=document.getElementById("mbAudio_"+a);0!=b(c).length&&b.mbAudio.players[a]||(a="string"==typeof a?b.mbAudio.sounds[a]:a,a=a.id?a.id:
"string"==typeof sound?sound:sound.mp3.split(".")[0].asId());return b.mbAudio.players[a]},onTimeUpdate:function(a,c){var d="string"==typeof a?b.mbAudio.sounds[a]:a,d=d.id?d.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[d]&&b.mbAudio.build(a);var f=b.mbAudio.getPlayer(d);b(f).on("timeupdate."+d,function(){c(this)})},preload:function(){for(var a in b.mbAudio.sounds)b.mbAudio.build(a);b(document).trigger("soundsLoaded")},play:function(a,c,d){var f="string"==typeof a?b.mbAudio.sounds[a]:
a;if(f){var h=f.id?f.id:"string"==typeof a?a:a.mp3.split(".")[0].asId(),e=f.loop?f.loop:b.mbAudio.defaults.loop,k="number"==typeof f.volume?f.volume:b.mbAudio.defaults.volume,k=10<k?10:k;b.mbAudio.build(a);var g=b.mbAudio.getPlayer(h);g.vol=k;g.volume=b.mbAudio.allMuted?0:g.vol/10;b(g).off("ended."+h+",paused."+h);"undefined"==typeof c&&(c=!0);if(!c||"string"!=typeof c&&"object"!=typeof c){if(e)b(g).one("ended."+h+",paused."+h,function(){this.currentTime=0;if("number"==typeof e&&("undefined"==typeof g.counter&&
(g.counter=0),g.counter++,g.counter===e)){delete g.counter;b.mbAudio.playing.splice(h,1);delete g.isPlaying;"function"==typeof d&&d(g);return}b.mbAudio.play(a,c,d)});else b(g).on("ended."+h+",paused."+h,function(){b.mbAudio.playing.splice(h,1);delete g.isPlaying;"function"==typeof d&&d(g)});g.pause();g.currentTime&&c&&(g.currentTime=0);g.play();f=jQuery.inArray(h,b.mbAudio.playing);b.mbAudio.playing.splice(f,1);b.mbAudio.playing.push(h);g.isPlaying=!0}else if(c="string"==typeof c?f.sprite[c]:c,clearTimeout(g.timeOut),
isAndroid||0!=g.seekable.length)b.mbAudio.manageSprite(g,h,a,c,d);else{g.play();isMoz||g.pause();var l=setInterval(function(){0<g.seekable.length&&g.seekable.end(0)>=c.end-1&&(clearInterval(l),b.mbAudio.manageSprite(g,h,a,c,d))},1)}}},manageSprite:function(a,c,d,f,h){function e(a,b,d,c,f){a.currentTime=c.start;a.currentTime!=c.start?e(a,b,d,c,f):k(a,b,d,c,f)}function k(a,d,c,e,f){var h=1E3*(e.end-e.start)+100,k=!0;a.play();a.isPlaying=!0;a.timeOut=setTimeout(function(){e.loop?(k=!1,e.loop=!0==e.loop?
9999:e.loop,a.counter||(a.counter=1),a.counter!=e.loop&&a.isPlaying?(a.counter++,a.currentTime=e.start||0,b.mbAudio.play(c,e,f)):(a.counter=0,k=!0,a.pause(),delete a.isPlaying)):(a.pause(),delete a.isPlaying);k&&"function"==typeof f&&f(a);var h=jQuery.inArray(d,b.mbAudio.playing);b.mbAudio.playing.splice(h,1)},h);b.mbAudio.playing.push(d);a.isPlaying=!0}a.pause();e(a,c,d,f,h)},stop:function(a,c){if(a){var d="string"==typeof a?b.mbAudio.sounds[a]:a;if(d){var f=d.id?d.id:"string"==typeof a?a:a.mp3.split(".")[0].asId(),
d=b.mbAudio.getPlayer(f);1!=b.mbAudio.loaded[f]&&b.mbAudio.build(a);d.pause();d.currentTime&&(d.currentTime=0);b(d).off("ended."+f);"function"==typeof c&&c(d);f=jQuery.inArray(f,b.mbAudio.playing);b.mbAudio.playing.splice(f,1);delete d.isPlaying;delete d.counter}}},pause:function(a,c){var d="string"==typeof a?b.mbAudio.sounds[a]:a,f=d.id?d.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[f]&&b.mbAudio.build(a);d=b.mbAudio.getPlayer(f);d.pause();b(d).off("ended."+f);f=jQuery.inArray(f,
b.mbAudio.playing);-1<f&&b.mbAudio.playing.splice(f,1);delete d.isPlaying;delete d.counter;clearTimeout(d.timeOut);"function"==typeof c&&c()},destroy:function(a){var c="string"==typeof a?b.mbAudio.sounds[a]:a;a=c.id?c.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();b.mbAudio.loaded[a]=0;c=jQuery.inArray(a,b.mbAudio.playing);b.mbAudio.playing.splice(c,1);(a=b.mbAudio.getPlayer(a))&&b(a).remove()},muteAllSounds:function(){var a=b.mbAudio.loaded;if(a){for(var c in a)a=b.mbAudio.getPlayer(c),a.vol=
10*a.volume,a.volume=0;b.mbAudio.allMuted=!0}},unMuteAllSounds:function(){var a=b.mbAudio.loaded;if(a){for(var c in a)a=b.mbAudio.getPlayer(c),a.volume=a.vol/10;b.mbAudio.allMuted=!1}},stopAllSounds:function(){var a=b.mbAudio.loaded;if(a){for(var c in a)b.mbAudio.destroy(c);b.mbAudio.allMuted=!0}},setVolume:function(a,c){var d="string"==typeof a?b.mbAudio.sounds[a]:a,d=d.id?d.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[d]&&b.mbAudio.build(a);d=b.mbAudio.getPlayer(d);d.vol=
10<c?10:c;d.volume=d.vol},fadeIn:function(a,c,d){c||(c=3E3);c/=4;var f="string"==typeof a?b.mbAudio.sounds[a]:a,h=f.id?f.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[h]&&b.mbAudio.build(a);var e=b.mbAudio.getPlayer(h),k="number"==typeof f.volume?f.volume:b.mbAudio.defaults.volume,k=10<k?10:k,g=k/10/c;clearInterval(e.fade);e.play();e.currentTime&&(e.currentTime=0);e.volume=0;if(!b.mbAudio.allMuted){var l=0;e.fade=setInterval(function(){l>=k/10?(clearInterval(e.fade),"function"==
typeof d&&d(e)):(e.volume=l,l+=g)},0)}b.mbAudio.playing.push(h);e.isPlaying=!0},fadeOut:function(a,c,d){c||(c=3E3);c/=4;var f="string"==typeof a?b.mbAudio.sounds[a]:a,h=f.id?f.id:"string"==typeof a?a:a.mp3.split(".")[0].asId();1!=b.mbAudio.loaded[h]&&b.mbAudio.build(a);var e=b.mbAudio.getPlayer(h);a=e.volume?10*e.volume:"number"==typeof f.volume?f.volume:b.mbAudio.defaults.volume;a=10<a?10:a;var k=a/10/c;clearInterval(e.fade);e.volume=a/10;e.play();var g=e.volume;e.fade=setInterval(function(){if(0>=
g){g=0;clearInterval(e.fade);e.volume=0;e.isPlaying=!1;var a=jQuery.inArray(h,b.mbAudio.playing);b.mbAudio.playing.splice(a,1);e.pause();"function"==typeof d&&d(e)}else e.volume=g,g-=k},0)},queue:{isStarted:!1,add:function(a,c,d,f){var h="string"==typeof a?a:a.mp3.split(".")[0].asId(),h=b.mbAudio.queue.get(h);null==h&&(h=new m(a));var e="string"==typeof a?b.mbAudio.sounds[a]:a;e.started||(b.mbAudio.pause(a),e.started=!0);c="string"==typeof c?e.sprite[c]:c;e={};e.soundID=a;e.sprite=c;e.channel=h;e.hasPriority=
f;e.callback=d;b.mbAudio.queue.isStarted||b.mbAudio.queue.startEngine();b.mbAudio.soundsMutedByHand||(e.hasPriority?(e.channel.playingSounds.splice(0,1),e.channel.soundInPlay=null,h.playingSounds.unshift(e)):h.playingSounds.push(e))},get:function(a){for(var c in b.mbAudio.ch)if(b.mbAudio.ch[c].name==a)return b.mbAudio.ch[c]},manage:function(){function a(a){null==a.soundInPlay&&a.playingSounds&&0<a.playingSounds.length&&!b.mbAudio.soundsMutedByHand&&!a.isMuted?(a.soundInPlay=a.playingSounds[0],b.mbAudio.play(a.soundInPlay.soundID,
a.soundInPlay.sprite,function(){"function"==typeof a.soundInPlay.callback&&a.soundInPlay.callback();a.playingSounds.splice(0,1);a.soundInPlay=null})):null!=a.soundInPlay&&a.soundInPlay.soundID&&(b.mbAudio.soundsMutedByHand||a.isMuted)&&(b.mbAudio.pause(a.soundInPlay.soundID),a.playingSounds=[],a.playingSounds.unshift(a.soundInPlay),a.soundInPlay=null)}for(var c in b.mbAudio.ch)a(b.mbAudio.ch[c])},mute:function(a){if(a){var c=b.mbAudio.queue.get(a);c&&(c.isMuted=!0);b.mbAudio.pause(a)}else b.mbAudio.soundsMutedByHand=
!0},unMute:function(a){if(a){if(a=b.mbAudio.queue.get(a))a.isMuted=!1}else b.mbAudio.soundsMutedByHand=!1},clear:function(a){if(a=b.mbAudio.queue.get(a))null!=a.soundInPlay&&b.mbAudio.pause(a.soundInPlay.soundID),a.soundInPlay=null,a.playingSounds=[]},startEngine:function(){b.mbAudio.channelsEngine=setInterval(b.mbAudio.queue.manage,1);b.mbAudio.queue.isStarted=!0},stopEngine:function(){clearInterval(b.mbAudio.channelsEngine);b.mbAudio.queue.isStarted=!1}}}})(jQuery);